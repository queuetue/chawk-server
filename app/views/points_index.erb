<div class="row">
    <div class="col-lg-12">
        <h1 class="page-header">Series '<%=  @addr.address %>'</h1>
        API path: points/<%=  @addr.address %>/data
    </div>
    <!-- /.col-lg-12 -->
</div>
<!-- /.row -->

<div class="row">
  <div class="col-lg-3">
    <div class="panel panel-info">
      <div class="panel-heading">
        <div class="row">
          <div class="col-xs-6">
            <i class="fa fa-comments fa-5x"></i>
          </div>
          <div class="col-xs-6 text-right">
            <p class="announcement-heading"><%= @addr.points.length %></p>
            <p class="announcement-text">Data Points</p>
          </div>
        </div>
      </div>
      <a href="#">
        <div class="panel-footer announcement-bottom">
          <div class="row">
            <div class="col-xs-6">
              View Data
            </div>
            <div class="col-xs-6 text-right">
              <i class="fa fa-arrow-circle-right"></i>
            </div>
          </div>
        </div>
      </a>
    </div>
  </div>
  <div class="col-lg-3">
    <div class="panel panel-warning">
      <div class="panel-heading">
        <div class="row">
          <div class="col-xs-6">
            <i class="fa fa-check fa-5x"></i>
          </div>
          <div class="col-xs-6 text-right">
            <p class="announcement-heading"><%= @last ? Time.at(@last.observed_at).strftime("%b %d %Y %H:%M") : "Never" %></p>
            <p class="announcement-text">Last Timestamp</p>
          </div>
        </div>
      </div>
      <a href="#">
        <div class="panel-footer announcement-bottom">
          <div class="row">
            <div class="col-xs-6">
              View Entry
            </div>
            <div class="col-xs-6 text-right">
              <i class="fa fa-arrow-circle-right"></i>
            </div>
          </div>
        </div>
      </a>
    </div>
  </div>
  <div class="col-lg-3">
    <div class="panel panel-danger">
      <div class="panel-heading">
        <div class="row">
          <div class="col-xs-6">
            <i class="fa fa-tasks fa-5x"></i>
          </div>
          <div class="col-xs-6 text-right">
            <p class="announcement-heading"><%= @addr.points.max %> / <%= @addr.points.min %></p>
            <p class="announcement-text">Min / Max</p>
          </div>
        </div>
      </div>
      <a href="#">
        <div class="panel-footer announcement-bottom">
          <div class="row">
            <div class="col-xs-6">
              See Data
            </div>
            <div class="col-xs-6 text-right">
              <i class="fa fa-arrow-circle-right"></i>
            </div>
          </div>
        </div>
      </a>
    </div>
  </div>
  <div class="col-lg-3">
    <div class="panel panel-success">
      <div class="panel-heading">
        <div class="row">
          <div class="col-xs-6">
            <i class="fa fa-comments fa-5x"></i>
          </div>
          <div class="col-xs-6 text-right">
            <p class="announcement-heading"><%= @addr.node.relations.count %></p>
            <p class="announcement-text">Related Users</p>
          </div>
        </div>
      </div>
      <a href="#">
        <div class="panel-footer announcement-bottom">
          <div class="row">
            <div class="col-xs-6">
              See Users
            </div>
            <div class="col-xs-6 text-right">
              <i class="fa fa-arrow-circle-right"></i>
            </div>
          </div>
        </div>
      </a>
    </div>
  </div>
</div><!-- /.row -->

    <div class="col-lg-8">
        <div class="panel panel-default">
            <div class="panel-heading">
                <i class="fa fa-bar-chart-o fa-fw"></i> Area Chart Example
                <div class="pull-right">
                    <div class="btn-group">
                        <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown">
                            Actions
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu pull-right" role="menu">
                            <li><a href="#">Action</a>
                            </li>
                            <li><a href="#">Another action</a>
                            </li>
                            <li><a href="#">Something else here</a>
                            </li>
                            <li class="divider"></li>
                            <li><a href="#">Separated link</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- /.panel-heading -->
            <div class="panel-body">
                <div id="morris-area-chart"></div>
            </div>
            <!-- /.panel-body -->
        </div>
    </div>


    <div class="col-lg-4">
        <div class="panel panel-default">

            <div class="panel-heading">
                <i class="fa fa-bell fa-fw"></i> New Value in Series
            </div>

           <form role="form" method="POST" action="/points/<%= @addr.address %>">
              <div class="form-group">
                <input class="form-control" name="new_data" placeholder="Enter a number here.">
              </div>
              <button type="submit" class="btn btn-default">New Value</button>
            </form>

        </div>
    </div>



    <div class="col-lg-4">
        <div class="panel panel-default">
            <div class="panel-heading">
                <i class="fa fa-bell fa-fw"></i> Notifications Panel
            </div>
            <!-- /.panel-heading -->
            <div class="panel-body">
                <div class="list-group">
                    <a href="#" class="list-group-item">
                        <i class="fa fa-heart fa-fw"></i> New Data
                        <span class="pull-right text-muted small"><em>10/7/2014 10:35:22</em>
                        </span>
                    </a>
                </div>
            </div>
            <!-- /.panel-body -->
        </div>
    </div>




<!-- Page-Level Plugin Scripts - Dashboard -->
<script src="/js/plugins/morris/raphael-2.1.0.min.js"></script>
<script src="/js/plugins/morris/morris.js"></script>

<!-- SB Admin Scripts - Include with every page -->
<script src="/js/sb-admin.js"></script>

<script>

var data = <%= @data.to_json %>


var graph;
var es = new EventSource('/connect');
var refreshData = function() {
    $.getJSON( '/points/foo/data', function(data) {
        graph.setData(data.data);
    });
}

$(document).ready(function() {

    graph = Morris.Line({
        element: 'morris-area-chart',
        data: data,
        xkey: 'x',
        ykeys: ['a'],
        labels: ['a'],
        parseTime: false,
        ymin: 'auto',
        ymax: 'auto',
        hideHover: true
    });

    refreshData();

});

es.onmessage = function(e) {
    var msg = $.parseJSON(event.data);
    refreshData();
    console.log(msg);
}


</script>